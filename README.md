# Donguri Bag Enhancer (DBE)

## 作者

仕様の設計・提案は「福呼び草」によって行われ、コーディング作業はChatGPT（OpenAI）によって行われました。  

## 概要

このスクリプトは、5ちゃんねるが提供する「どんぐりシステム」に含まれるゲーム要素に適用するものです。「アイテムバッグ」ページを機能拡張し、フィルタリング、ソート、スクロール追従、分解アラートなどの支援機能を提供します。

## 注意事項

- 本スクリプトは個人開発物であり、どんぐりシステム公式とは関係ありません。
- バグや仕様変更により正常に動作しない場合があります。ご了承ください。
- 質問やバグ報告は必ず非公式サポートの範囲内でお願いします。

## 既知の不具合

- 「宝箱の自動処理（進行状況）」において、処理回数のカウンターが機能していません。
- 「宝箱の自動処理（進行状況）」において、出現レアの抽出表示が機能していません。
- スマホ環境において、メニューボタンの位置が安定しません。
	- 例えば、スクロール時に一緒に動いてしまい、ボタンが画面外に行ってしまうことがあります。

## インストール方法

1. 「Tampermonkey」などのユーザースクリプト管理アドオンをブラウザにインストールします。
2. スクリプトファイル「Donguri_Bag_Enhancer.user.js」をTampermonkeyに読み込ませます。
3. https://donguri.5ch.net/bag にアクセスすると、自動的にスクリプトが適用されます。

## 更新履歴

- v8.15.1.31
	- 〈更新〉装備定義リストに「チョコレートハンマー」「月影の告白ゆかた」を追加しました。

- v8.15.1.30
	- 〈更新〉武器と防具における［フィルタカード］による選別において《Rarity》を他の選別条件から独立して判定するようにしました。

- v8.15.1.25
	- 〈更新〉武器と防具において、［フィルタカード］に《ロジック》を追加し「AND」か「OR」を選択できるようにしました。
	- 〈更新〉上記に伴い、選別条件の［すべて（無条件で合致すると見なす）］を［不問（判定せずに選別を素通りさせる）］に置き換えました。
	- 〈更新〉『［フィルタカード］ビルダー』のレイアウトを調整しました。
	- 〈更新〉作成済みの［フィルタカード］に通し番号を付与しました。
	- 〈更新〉作成済みの［フィルタカード］において項目の並び順を整理・統一しました。
	- 〈更新〉作成済みの［フィルタカード］において上移動させる機能を拡張しました。
	- 〈更新〉強い批判があったためどんぐり寄付の文言とリンクを削除しました。

- v8.14.0.10
	- 〈修正〉宝箱開封機能の終了後、「解錠」「錠」「分解」操作時にページリロードを抑止する機能が動作しなかった不具合を修正しました。
	- 〈修正〉クリック操作で「宝箱の自動処理（進行状況）」ウィンドウが「宝箱の開封と選別条件の設定」ウィンドウの後ろに隠れないようにしました。
	- 〈更新〉武器テーブルと防具テーブルにおいて、ELEM列のヘッダーをクリックした時のソート処理を、Element別→数値順で並び替えるように変更しました。

- v8.14.0.5
	- 〈更新〉［フィルタカード］の背景色を、ネックレス、武器、防具で異なる配色にしました。

- v8.14.0.3
	- 〈修正〉宝箱開封の自動処理中にサーバーエラー「ng<>too fast」が発生すると、宝箱開封のボタンが機能しなくなる不具合を修正しました。

- v8.14.0.2
	- 〈更新〉［フィルタカード］のjsonをインポートする際、DBEのバージョンが古い場合には警告が表示されるようにしました。

- v8.14.0.0
	- 〈Beta〉［フィルタカード（宝箱の自動処理）］の選別条件に、minATK、maxATK、minDEF、maxDEF、CRITを追加しました。

- v8.13.21.1
	- 〈修正〉[解]または[解錠]をクリックした時のページリロードを抑止する機能がうまく働かない場合がある不具合を修正しました。
	- 〈更新〉提供いただいたネックレスのDeBuff表記を着色するコードを組み込みました。(*1)

- v8.13.19.1
	- 〈更新〉装備定義リストに「極光の冠兜」を追加しました。
	- 〈更新〉装備中のアイテムの「ELEM」列にエレメントに応じた着色が行われるようにしました。

- v8.13.18.6
	- 〈修正〉「名称列と装備列の間にアイテムIDを表示する」が有効な時に「再読込」ボタンをクリックするとレイアウトが崩れる不具合を修正しました。
	- 〈修正〉「再読込」ボタンをクリックした時、ソート状況が正しく反映されない不具合を修正しました。
	- 〈修正〉「解」列のソートが4回切替になっていた不具合を修正しました。（本来の2回切替に修正しました。）

- v8.13.17.5
	- 〈更新〉装備定義リストに「ツンドラ守護者の胴衣」を追加しました。

- v8.13.17.4
	- 〈更新〉装備定義リストに「雪崩の甲殻」を追加しました。

- v8.13.17.3
	- 〈更新〉装備定義リストに「氷霜のシュラウド」を追加しました。

- v8.13.17.2
	- 〈修正〉フォーカスが別タブや別アプリに移ると、ソートやフィルタリングの状態が維持できなくなる不具合を修正しました。
	- 〈更新〉それぞれの「再読込」ボタンはその装備種のテーブルのみを更新するように変更しました。
		- ページ全体を更新したい時は、ブラウザの「ページの再読み込み」等を使用してください。

- v8.13.16.3
	- 〈更新〉装備定義リストに「凍傷スリング」を追加しました。

- v8.13.16.2
	- 〈修正〉英字を含む装備（「ウサギの耳R」など）のレアリティ判定に失敗する不具合を修正しました。
	- 〈修正〉一部の限定装備が常設装備に含まれていた不具合を修正しました。
	- 〈修正〉「アイテムID」列を表示した場合に、他の列のソート機能が正しく動作しなくなる場合がある不具合を修正しました。
	- 〈修正〉「ネックレステーブル」の「フィルターUI」が二重に表示される場合がある不具合を修正しました。
	- 〈修正〉「ネックレステーブル」の「増減」列が重複して表示される場合がある不具合を修正しました。
	- 〈更新〉ハンバーガーメニューを分解し、メニューバーに置き換えました。
	- 〈更新〉武器と防具の各テーブルにおいて、装備名のセルをクリックすると同名の装備が抽出されるようにしました。
	- 〈更新〉武器と防具の各テーブルにおいて、ソート条件を見直しました。
	- 〈更新〉誤って「Donguri Bag Enhancer」を重複インストールした場合、より新しいバージョンが実行されるようにしました。
	- 〈更新〉作者の都合により、バージョン表記を3段階から4段階に増やしました。
	- 〈Beta〉宝箱を開封して選別する機能を追加しました。

- v8.1.0.0
	- 〈新規〉アイテムID列を任意に追加表示できるようにしました。
	- 〈新規〉アイテムID列のボタンをクリックすると、クリップボードにアイテムIDがコピーされるようにしました。
	- 〈新規〉表のセルの余白を任意に指定できるようにしました。

- v8.0.1.0
	- 〈新規〉IDが指定数値以下のアイテム行を非表示にできるようにしました。

- v7.4.0.0
	- 〈新規〉武器テーブルと防具テーブルにおいて、アイテム名列のヘッダーをクリックすると行がソートされるようにしました。
		- (1)レアリティ正順→(2)同逆順→(3)限定抽出ふりがな正順→(4)同逆順→(5)全装備ふりがな正順→(6)同逆順→以下ループ
	- 〈新規〉アイテム名称欄の《装備種（ネックレス等）とクラス（グレード等）》表記を隠せるようにしました。
	- 〈新規〉《錠／解錠》列を隠せるようにしました。非表示は、ロック中のアイテムに「閉じた南京錠」の絵文字がつきます。
	- 〈更新〉レイアウトを一部で変更しました。

- v7.0.7.0
	- 〈修正〉アイテムバッグ拡張のリンクをクリックすると表示が崩れる場合がある不具合を修正しました。
	- 〈修正〉コード重複など内部の細かな問題を修正しました。
	- 〈新規〉アイテムバッグにおける基準となる文字サイズを選べるようにしました。（標準：PC=16px、スマホ=14px）
	- 〈新規〉Donguri Bag Enhancerのバージョンを表示するようにしました。
	- 〈更新〉レイアウトを一部で変更しました。

- v5.1.3.0
	- 〈修正〉「どんぐり転送サービス」のフォームへ常に作者のどんぐりIDが入力されてしまう不具合を修正しました。
	- 〈修正〉ネックレス／武器／防具の各テーブルにおいて、フィルターやソートの機能が正しく動作しないことがある不具合を修正しました。
	- 〈修正〉ネックレス／武器／防具の各テーブルにおいて、フィルターの切り替え時にソート状況が引き継がれないことがある不具合を修正しました。
	- 〈新規〉サブウィンドウの枠外をクリックすると、サブウィンドウを閉じるようにしました。
	- 〈更新〉ソート時に表示されるインジケーターを、視認性の改善を目的として、フォントの矢印からSVGで生成した矢印に変更しました。
	- 〈更新〉ネックレス／武器／防具の各テーブルにおいて、ソート機能がない列へのソート機能実装や、既存のソート機能の改修強化を行いました。

- v4.9.0.0
	- 〈新規〉RarityとElementのチェックボックス、およびセルクリックによる行抽出時に、直前のソート状況を引き継ぐようにしました。
	- 〈新規〉列の一部で、ソート時にインジケーター「⬆」「⬇」を表示するようにしました。
	- 〈更新〉「ATK」列のソート機能を改善しました。ヘッダーをクリックするごとに、最大攻撃力（降順→昇順）→最小攻撃力（降順→昇順）でソートされます。
	- 〈更新〉「DEF」列のソート機能を改善しました。ヘッダーをクリックするごとに、最大防御力（降順→昇順）→最小防御力（降順→昇順）でソートされます。

- v4.8.2.0
	- 〈修正〉ネックレスの「属性」の値の合計が 0 になる時に「増減」列のセルが空白になる不具合を修正しました。
	- 〈修正〉武器の「名称」列と「ELEM」列のセルをクリックして絞り込みを行った時にソート機能が働いていない不具合を修正しました。
	- 〈新規〉「解」列における[錠]、[解錠]の背景色をサブウインドウで選択できるようにしました。
	- 〈更新〉武器と防具のフィルター機能を変更しました。
		- チェックを入れると、そのRarityまたはElementで装備が絞り込まれるようにしました。
		- 「全選択」ボタンを撤去しました。
	- 〈更新〉「「全て分解」まきこみアラート」による検知時、ネックレスのグレードを日本語で表示するようにしました。

- v4.6.2.0
	- 〈修正〉クリックしたセルが画面中央に来るように自動でスクロールする機能が想定外の動作をしていた不具合を修正しました。
	- 〈修正〉[分解]を行った時に対象の行が削除されない不具合を修正しました。
	- 〈新規〉「Donguri Bag Operator v3.1.2」を統合し、ひとつのファイルにしました。
	- 〈新規〉「解」列のヘッダーをクリックすると、施錠（ロック）の有無でソートされるようにしました。
	- 〈新規〉サブウインドウを実装しました。
	- 〈新規〉サブウインドウに「「全て分解」まきこみアラート」を実装しました。
	- 〈新規〉サブウインドウに「増減」列、「分解」列、「全て分解」ボタンの表示／非表示を切り替える機能を実装しました。
	- 〈新規〉サブウインドウに「全て分解」ボタンを実装しました。

- v2.1.3.0
	- 〈新規〉README.txtを添付しました。

### 注釈
(*1) "ID:YTtKPa4Z0"さん提供。https://kes.5ch.net/test/read.cgi/donguri/1726752559/63
